---
title: 'Estudo de caso: Grupo D 3'
author: "Gilmar Pereira, Maressa Tavares e Victor Ruela"
date: "29 de Outubro, 2019"
output:
  pdf_document:
    fig_caption: yes
    number_sections: yes
header-includes:
  \usepackage{float}
  \floatplacement{figure}{H}

bibliography: refsCS03.bib
csl: ieee.csl
---


```{r setup,results='hide',warning=FALSE,echo=FALSE, message=FALSE, include=FALSE}
# A few initial definitions just to make sure all required packages are installed. Change as needed.
# NOTE: It may echo some weird messages to the PDF on the first compile (package installation messages). Run twice and the problem will (hopefully) go away.
if (!require(ggplot2, quietly = TRUE)){
      install.packages("ggplot2")
      }
if (!require(devtools, quietly = TRUE)){
      install.packages("devtools")
      }
 if (!require(broom, quietly = TRUE)){
       devtools::install_github("dgrtwo/broom")
      }
if (!require(GGally, quietly = TRUE)){
      install.packages("GGally")
}

if (!require(ExpDE, quietly = TRUE)){
  install.packages("ExpDE")
}

if (!require(car, quietly = TRUE)){
  install.packages("car")
}

if (!require(boot, quietly = TRUE)){
  install.packages("boot")
}

if (!require(dplyr, quietly = TRUE)){
  install.packages("boot")
}

if (!require(pwr, quietly = TRUE)){
  install.packages("pwr")
}


if (!require(smoof, quietly = TRUE)){
  install.packages("smoof")
}

if (!require(CAISEr, quietly = TRUE)){
  install.packages("CAISEr")
}

```
# Summary

# Planejamento do experimento
## Objetivo do experimento


$$\begin{cases} H_0: \mu_{1} = \mu_{2}&\\H_1: \mu_{1} \neq \mu_{2}\end{cases}$$
Onde $\mu_{1}$ e $\mu_{2}$ são as turmas de 2016-7 e 2017-2, respectivamente. A mesma hipótese será testada separadamente para cada sub-população. 

Os testes serão realizados para um tamanho de efeito $\delta^* = 5$, visto que essa é a diferença de valor entre os níveis de classificação IMC encontrados na literatura [@tabelaimc:online]. 


## Análise Exploratória dos Dados
```{r constants, echo=FALSE}
# Equipe D
## Config 1
recpars1 <- list(name = "recombination_blxAlphaBeta", alpha = 0.4, beta = 0.4)
mutpars1 <- list(name = "mutation_rand", f = 4)

## Config 2
recpars2 <- list(name = "recombination_eigen", othername = "recombination_bin", cr = 0.9)
mutpars2 <- list(name = "mutation_best", f = 2.8)

# Normalized effect size
d <- 0.5
# Significance
alpha <- 0.05
# Power
power <- 0.8

```

```{r datageneration, echo=FALSE}
suppressPackageStartupMessages(library(ExpDE))
set.seed(15632) # set a random seed

generate.observation <- function(mutparsX, recparsX, dim, fn){

  selpars <- list(name = "selection_standard")
  stopcrit <- list(names = "stop_maxeval", maxevals = 5000 * dim, maxiter = 100 * dim)
  probpars <- list(name = fn, xmin = rep(-5, dim), xmax = rep(10, dim))
  popsize = 5 * dim
  
  out <- ExpDE(mutpars = mutparsX,
            recpars = recparsX,
            popsize = popsize,
            selpars = selpars,
            stopcrit = stopcrit,
            probpars = probpars,
            showpars = list(show.iters = "dots", showevery = 20))
  return(out$Fbest)
}

generate.n.observations <- function(mutparsX, recparsX, dim, fn, N){
  my.sample <- numeric(N)
  for (i in seq(N)){
    my.sample[i] <- generate.observation(mutparsX, recparsX, dim, fn)
  }
  
  return(my.sample)
}
```

```{r testematrix}
# testing the function on a matrix composed of 2 points
N <- 30

if(!file.exists('CS03data_ea_dim2.csv')){
  
  dim <- 2
  fn.rosenbrock <- function(X){
    if(!is.matrix(X)) X <- matrix(X, nrow = 1) # <- if a single vector is passed as X
  
    Y <- apply(X, MARGIN = 1, FUN = smoof::makeRosenbrockFunction(dimensions = dim))
    return(Y)
  }

  sample.config1 <- data.frame(value = generate.n.observations(mutpars1, recpars1, dim, "fn.rosenbrock", N), "config" = rep('config1',N))
  sample.config2 <- data.frame(value = generate.n.observations(mutpars2, recpars2, dim, "fn.rosenbrock", N), "config" = rep('config2',N))
  
  sample.all = rbind(sample.config1, sample.config2)
  write.csv('CS03data_ea_dim2.csv',x = sample.all, row.names = FALSE)

  } else{
  sample.all.dim2 <- read.csv('CS03data_ea_dim2.csv')
  sample.config1.dim2 <- sample.all.dim2[which(sample.all.dim2$config == 'config1'),]
  sample.config2.dim2 <- sample.all.dim2[which(sample.all.dim2$config == 'config2'),]
  }


if(!file.exists('CS03data_ea_dim15.csv')){
  
  dim <- 15
  fn.rosenbrock <- function(X){
    if(!is.matrix(X)) X <- matrix(X, nrow = 1) # <- if a single vector is passed as X
  
    Y <- apply(X, MARGIN = 1, FUN = smoof::makeRosenbrockFunction(dimensions = dim))
    return(Y)
  }

  sample.config1.dim15 <- data.frame(value = generate.n.observations(mutpars1, recpars1, dim, "fn.rosenbrock", N), "config" = rep('config1',N))
  sample.config2.dim15 <- data.frame(value = generate.n.observations(mutpars2, recpars2, dim, "fn.rosenbrock", N), "config" = rep('config2',N))
  
  sample.all = rbind(sample.config1, sample.config2)
  write.csv('CS03data_ea_dim15.csv',x = sample.all, row.names = FALSE)

  } else{
  sample.all.dim15 <- read.csv('CS03data_ea_dim15.csv')
  sample.config1.dim15 <- sample.all.dim15[which(sample.all.dim15$config == 'config1'),]
  sample.config2.dim15 <- sample.all.dim15[which(sample.all.dim15$config == 'config2'),]
}

```

```{r summary_statistic_2016}
summary(sample.config1.dim2)
summary(sample.config2.dim2)
```


```{r plot_boxplot, echo=FALSE, fig.width=7,fig.height=4, fig.cap="Boxplot dos dados\\label{fig:boxplot}"}
par(mfrow=c(1,2))
ggplot(sample.all.dim2, aes(x=config, y=value)) + geom_boxplot()
ggplot(sample.all.dim15, aes(x=config, y=value)) + geom_boxplot()
```

```{r plot_histogram, echo=FALSE, fig.width=7,fig.height=4, fig.cap="Boxplot dos dados\\label{fig:boxplot}"}
par(mfrow=c(1,2))
ggplot(sample.all.dim2, aes(x=value, fill=config)) + geom_histogram(bins = 50)
ggplot(sample.all.dim15, aes(x=value, fill=config)) + geom_histogram(bins = 50)
```


```{r plot_norm, echo=FALSE, fig.width=7,fig.height=4, fig.cap="Gráfico quantil-quantil das populações - Feminino"}
par(mfrow=c(1,2))
invisible(qqPlot(sample.config1$value, dist='norm',envelope=.95, las = 1, pch = 16, main="Q-Q plot algoritmo 1", ylab = "value"))

invisible(qqPlot(sample.config2$value, dist='norm',envelope=.95, las = 1, pch = 16, main="Q-Q plot algoritmo 2", ylab = "value"))
```

```{r plot_norm, echo=FALSE, fig.width=7,fig.height=4, fig.cap="Gráfico quantil-quantil das populações - Feminino"}
par(mfrow=c(1,2))
invisible(qqPlot(sample.config1.dim2$value, dist='norm',envelope=.95, las = 1, pch = 16, main="Q-Q plot algoritmo 1", ylab = "value"))

invisible(qqPlot(sample.config1.dim15$value, dist='norm',envelope=.95, las = 1, pch = 16, main="Q-Q plot algoritmo 2", ylab = "value"))
```

```{r plot_norm, echo=FALSE, fig.width=7,fig.height=4, fig.cap="Gráfico quantil-quantil das populações - Feminino"}
par(mfrow=c(1,2))
invisible(qqPlot(sample.config2.dim2$value, dist='norm',envelope=.95, las = 1, pch = 16, main="Q-Q plot algoritmo 1", ylab = "value"))

invisible(qqPlot(sample.config2.dim15$value, dist='norm',envelope=.95, las = 1, pch = 16, main="Q-Q plot algoritmo 2", ylab = "value"))
```


```{r shapirotest}
shapiro.test(sample.config1$value)
shapiro.test(sample.config2$value)
```


## Referências
